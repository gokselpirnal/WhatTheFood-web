"use strict";angular.module("wtf",["ui.bootstrap","ui.router","ngNotify","angular-loading-bar","ngCookies","angularMoment"]).run(["$rootScope","$cookieStore","$location","$http","ngNotify",function(e,t,l,r,o){o.config({theme:"pure",position:"bottom",duration:1e3,type:"info",sticky:!1,html:!1});var a=window.location.host;e.serviceUrl="http://"+a+"/vtys_WhatTheFood/api",e.globals=t.get("globals")||{},e.globals.currentUser&&(r.defaults.headers.common.token=e.globals.currentUser.token),e.$on("$locationChangeStart",function(){"/register"!=l.path()||e.globals.currentUser?"/login"==l.path()||e.globals.currentUser||l.path("/login"):l.path("/register"),"/login"==l.path()&&e.globals.currentUser&&l.path("/")})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("index",{url:"/",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/home/home.html",controller:"HomeCtrl"}}}).state("about",{url:"/about",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/about/about.html",controller:"AboutCtrl"}}}).state("profile_edit",{url:"/profile/edit",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/profile/edit.html",controller:"UserCtrl"}}}).state("profile",{url:"/profile/:userId",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/profile/profile.html",controller:"UserCtrl"}}}).state("food_add",{url:"/food/add",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/food/add.html",controller:"FoodCtrl"}}}).state("food_detail",{url:"/food/:foodId",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/food/detail.html",controller:"FoodCtrl"}}}).state("category",{url:"/category/:categoryId",views:{header:{templateUrl:"templates/header/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"templates/footer/footer.html",controller:"FooterCtrl"},content:{templateUrl:"templates/food/list.html",controller:"FoodCtrl"}}}).state("login",{url:"/login",views:{full:{templateUrl:"templates/user/login.html",controller:"LoginCtrl"}}}).state("register",{url:"/register",views:{full:{templateUrl:"templates/user/register.html",controller:"RegisterCtrl"}}}).state("logout",{url:"/logout",views:{full:{templateUrl:"templates/user/login.html",controller:"LoginCtrl"}}})}]);
angular.module("wtf").controller("FoodCtrl",["$scope","FoodService","CategoryService","UserService","$state","$stateParams","$rootScope","$location","$cookies","ngNotify","$http",function(o,e,t,i,r,n,a,s,c,d,u){o.profile={},o.foods={},o.food={},o.newFood={},o.page=0,o.categories=[],o.selectedCategoryName="Kategori Seçiniz",o.material="",o.isLastPage=!1,o.user=c.getObject("globals").currentUser,o.getPage=function(t){o.page=t,e.profile(t,function(e){e.error||e.user_id&&(o.profile=e)})},o.detail=function(t){t=t||n.foodId,e.detail(t,function(e){200==e.status?o.food=e.data:d.set("Tarif bulunamadı !",{position:"bottom",type:"error",duration:2e3,button:!0,sticky:!0})})},o.getUserProfile=function(o){i.profile(o,function(o){return o})},o.saveFood=function(){e.create(o.newFood,function(e){e.error||(console.log(e),o.food=e,d.set("Tarifiniz Kaydedildi",{position:"bottom",type:"error",duration:2e3,button:!0,sticky:!0}))})},o.removeFood=function(o){e.remove(o,function(o){200==o.status?d.set("Tarfiniz Silindi",{position:"bottom",type:"error",duration:2e3,button:!0,sticky:!0}):d.set("Tarfiniz silinemedi",{position:"bottom",type:"info",duration:2e3,button:!0,sticky:!0})})},o.getFoodsFromCategoryId=function(){o.isLastPage||t.getFoods(n.categoryId,o.page++,function(e){e.error||(console.log(e),(0==e.length||e.length<6)&&(o.isLastPage=!0),Array.prototype.push.apply(o.foods,e))})},o.getCategories=function(){return a.categories?void(o.categories=a.categories):void t.getAll(function(e){e.error||(o.categories=e)})},o.setCategory=function(e){o.newFood.category_id=e.category_id,o.selectedCategoryName=e.name},o.addMaterial=function(e){e&&(o.newFood.materials?o.newFood.materials+="\n"+e:o.newFood.materials=e,o.material="")}}]);
angular.module("wtf").controller("FooterCtrl",["$scope","$cookies",function(e,o){e.title="WhatTheFood",e.user=o.getObject("globals").currentUser}]);
angular.module("wtf").controller("HeaderCtrl",["$scope","$rootScope","$cookies","CategoryService",function(e,t,o,r){e.title="WhatTheFood",e.user=o.getObject("globals").currentUser,e.getCategories=function(){r.getAll(function(o){e.categories=o,t.categories=e.categories})},t.categories||e.getCategories()}]);
angular.module("wtf").controller("HomeCtrl",["$scope","HomeService","$rootScope","$location","$cookies","$http",function(o,e,t,s,r,c){o.latestFoods=[],o.searchedFoods=void 0,o.searchText="",o.latestFoods=function(){e.latestFoods(function(e){e.error||(o.latestFoods=e)})},o.search=function(t){e.search(t,function(e){e.error||(o.searchedFoods=e)})},o.latestFoods()}]);
angular.module("wtf").controller("LoginCtrl",["$scope","LoginService","$rootScope","$location","$cookies","$http",function(o,e,t,l,n,a){var r=window.location.hash;"#/logout"==r&&n.putObject("globals",{}),o.user={email:"",password:""},o.login=function(o){var r=o.email,s=o.password;e.login(r,s,function(o){o.error||(e.setCredentials(o),n.putObject("globals",t.globals),a.defaults.headers.common.token=t.globals.currentUser.token,l.path("/"))})}}]);
function MasterCtrl(o,t){var e=992,g="#/login"==window.location.hash||"#/register"==window.location.hash?!0:!1,n=Math.floor(6*Math.random());console.log(g),console.log(n),o.getWidth=function(){return window.innerWidth},o.$watch(o.getWidth,function(g,n){g>=e?angular.isDefined(t.get("toggle"))?o.toggle=t.get("toggle")?!0:!1:o.toggle=!0:o.toggle=!1}),o.toggleSidebar=function(){o.toggle=!o.toggle,t.put("toggle",o.toggle)},window.onresize=function(){o.$apply()}}angular.module("wtf").controller("MasterCtrl",["$scope","$cookies",MasterCtrl]);
angular.module("wtf").controller("RegisterCtrl",["$scope","RegisterService","$rootScope","$location","$cookies","$http",function(t,i,o,r,e,a){t.user={email:"",password:""},t.msg={show:!1},t.register=function(t){var o=t.email,r=t.password;i.register(o,r,function(t){t.error||(t.message?ngNotify.set("Kaydınız tamamlandı. Giriş yapabilirsiniz.",{position:"bottom",duration:2e3,button:!0,sticky:!0,"default":error}):t.id&&ngNotify.set("Kaydınız tamamlandı. Giriş yapabilirsiniz.",{position:"bottom",duration:2e3,button:!0,sticky:!0,"default":error}))})}}]);
angular.module("wtf").controller("SidebarCtrl",["$scope","$cookies",function(e,n){e.menus=[{name:"Yemek Ara",href:"#/search",icon:"fa-home"},{name:"Yemek Ekle",href:"#/new-food",icon:"fa-pencil"},{name:"Kullanıcı Yönetimi",href:"#/users",icon:"fa-users"},{name:"Kategori Yönetimi",href:"#/categories",icon:"fa-folder-open"}]}]);
angular.module("wtf").controller("UserCtrl",["$scope","UserService","$state","$stateParams","$filter","$rootScope","$location","$cookies","ngNotify","$http",function(o,e,t,r,i,s,n,l,p,a){o.profile={},o.userFoods={},o.page=0,o.isLastPage=!1,o.profile=function(t){t=t||r.userId,e.profile(t,function(e){e.error||e.user_id&&(o.profile=e)})},o.foods=function(){o.isLastPage||e.foods(r.userId,o.page++,function(e){e.error||(console.log("response"),console.log(e),(0==e.length||e.length<6)&&(o.isLastPage=!0),Array.prototype.push.apply(o.userFoods,e))})},o.updateProfile=function(o){e.updateProfile(o,function(o){console.log(o),200==o.status?(p.set("Profiliniz güncellendi",{position:"bottom",type:"error",duration:4e3,button:!0,sticky:!0}),n.path("#/profile/"+s.currentUser._id)):p.set("Profiliniz güncellenemedi",{position:"bottom",type:"error",duration:4e3,button:!0,sticky:!0})})},o.profile(),o.foods()}]);
angular.module("wtf").factory("CategoryService",["$http","$rootScope",function(t,e){var n={};return n.getAll=function(n){t({method:"GET",url:e.serviceUrl+"/category/all",data:null,headers:{"Content-Type":"application/json"}}).then(function(t){n(t.data)})},n.getFoods=function(n,o,a){t({method:"GET",url:e.serviceUrl+"/category/"+n+"/"+o,data:null,headers:{"Content-Type":"application/json"}}).then(function(t){a(t.data)})},n}]);
angular.module("wtf").factory("FoodService",["$http","$rootScope",function(e,n){var o={};return o.getPage=function(o,t){e({method:"GET",url:n.serviceUrl+"/food/all/"+o,data:null,headers:{"Content-Type":"application/json"}}).then(function(e){t(e)})},o.detail=function(o,t){e({method:"GET",url:n.serviceUrl+"/food/"+o,data:null,headers:{"Content-Type":"application/json"}}).then(function(e){t(e)})},o.create=function(o,t){e({method:"POST",url:n.serviceUrl+"/food",data:o,headers:{"Content-Type":"application/json"}}).then(function(e){t(e)})},o.update=function(o,t){e({method:"PUT",url:n.serviceUrl+"/food/"+o.food_id,data:null,headers:{"Content-Type":"application/json"}}).then(function(e){t(e)})},o.remove=function(o,t){e({method:"DELETE",url:n.serviceUrl+"/food/"+o,data:null,headers:{"Content-Type":"application/json"}}).then(function(e){t(e)})},o}]);
angular.module("wtf").factory("HomeService",["$http","$rootScope",function(t,e){var o={};return o.latestFoods=function(o){t({method:"GET",url:e.serviceUrl+"/food/all/0",data:null,headers:{"Content-Type":"application/json"}}).then(function(t){o(t.data)})},o.search=function(o,a){var n={search:o};t({method:"POST",url:e.serviceUrl+"/food/search",data:n,headers:{"Content-Type":"application/json"}}).then(function(t){a(t.data)})},o}]);
angular.module("wtf").factory("LoginService",["$http","$rootScope",function(e,n){var t={};return t.login=function(t,o,a){var r={email:t,password:o};e({method:"POST",url:n.serviceUrl+"/login",data:r,headers:{"Content-Type":"application/json"}}).then(function(e){a(e.data)})},t.setCredentials=function(e){n.globals={currentUser:{_id:e.user_id,email:e.email,token:e.token.token}}},t}]);
angular.module("wtf").factory("RegisterService",["$http","$rootScope",function(e,t){var r={};return r.register=function(r,a,n){var o={email:r,password:a};e({method:"POST",url:t.serviceUrl+"/register",data:o,headers:{"Content-Type":"application/json"}}).then(function(e){n(e.data)})},r}]);
angular.module("wtf").factory("UserService",["$http","$rootScope",function(e,t){var n={};return n.profile=function(n,o){e({method:"GET",url:t.serviceUrl+"/user/"+(n||t.globals.currentUser._id)+"/profile",data:null,headers:{"Content-Type":"application/json"}}).then(function(e){o(e.data)})},n.foods=function(n,o,r){e({method:"GET",url:t.serviceUrl+"/user/"+(n||t.globals.currentUser._id)+"/foods/"+(o||0),data:null,headers:{"Content-Type":"application/json"}}).then(function(e){r(e.data)})},n.updateProfile=function(n,o){e({method:"PUT",url:t.serviceUrl+"/user/profile",data:n,headers:{"Content-Type":"application/json"}}).then(function(e){o(e)})},n}]);